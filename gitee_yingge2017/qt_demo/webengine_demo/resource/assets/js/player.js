(function(t){function e(e){for(var s,r,o=e[0],c=e[1],l=e[2],h=0,d=[];h<o.length;h++)r=o[h],a[r]&&d.push(a[r][0]),a[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);u&&u(e);while(d.length)d.shift()();return n.push.apply(n,l||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,o=1;o<i.length;o++){var c=i[o];0!==a[c]&&(s=!1)}s&&(n.splice(e--,1),t=r(r.s=i[0]))}return t}var s={},a={player:0},n=[];function r(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=s,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;n.push([8,"chunk-vendors","chunk-common"]),i()})({3070:function(t,e,i){},"34fa":function(t,e,i){"use strict";var s=i("6684"),a=i.n(s);a.a},6684:function(t,e,i){},8:function(t,e,i){t.exports=i("8e73")},"8e73":function(t,e,i){"use strict";i.r(e);var s,a,n,r,o,c,l=i("a026"),u=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("div",{staticClass:"window_con"},[s("div",{staticClass:"btn_close",on:{click:t.closeWindow}},[s("img",{attrs:{src:i("71e1")}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isPlay&0==t.step,expression:"!isPlay&step==0"}],staticClass:"userImg",style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px",marginLeft:-t.canvasWidth/2+"px"}},[s("img",{attrs:{src:t.userImg,height:"100%"}})]),t.originImg?s("div",{directives:[{name:"show",rawName:"v-show",value:t.isPlay||0!==t.step,expression:"isPlay||step!==0"}],staticClass:"userImg",style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px",marginLeft:-t.canvasWidth/2+"px"}},[s("img",{attrs:{src:t.originImg+"?x-oss-process=image/resize,w_"+t.canvasHeight,height:"100%"}})]):t._e(),s("canvas",{staticClass:"board",style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px",marginLeft:-t.canvasWidth/2+"px"},attrs:{id:"myCanvas",width:t.canvasWidth,height:t.canvasHeight}}),t.currStuInfo?s("div",{directives:[{name:"show",rawName:"v-show",value:t.currStuInfo.length>1,expression:"currStuInfo.length>1"}],staticClass:"arrows"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.currPageIndex>0,expression:"currPageIndex>0"}],staticClass:"arrow_left",on:{click:t.checkPre}},[s("img",{attrs:{src:i("4dc9")}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.currPageIndex<t.currStuInfo.length-1,expression:"currPageIndex < currStuInfo.length-1"}],staticClass:"arrow_right",on:{click:t.checkNext}},[s("img",{attrs:{src:i("33c9")}})])]):t._e(),s("div",{staticClass:"menus",style:{width:t.canvasWidth+"px",marginLeft:-t.canvasWidth/2+"px"}},[s("div",{staticClass:"btnPlay",on:{click:t.play}},[t.isPlay?s("img",{attrs:{src:i("88ae")}}):s("img",{attrs:{src:i("df84")}})]),s("progress-bar",{attrs:{width:"100%",percent:t.percent},on:{"pbar-drag":t.setPercent,"pbar-seek":t.setPercent}}),s("div",{staticClass:"speed"},[s("span",{staticClass:"btn_speed",class:{active:1==t.speed},on:{click:function(e){return t.setSpeed(1)}}},[t._v("4X")]),s("span",{staticClass:"btn_speed",class:{active:10==t.speed},on:{click:function(e){return t.setSpeed(10)}}},[t._v("2X")]),s("span",{staticClass:"btn_speed",class:{active:20==t.speed},on:{click:function(e){return t.setSpeed(20)}}},[t._v("1X")])])],1)])])},h=[],d=i("1bd8"),p=i("8271"),f=i("3b29"),g=i("bf31"),v=i.n(g),m=i("b8ba"),y=i.n(m),w=i("bc3a"),b=i.n(w);function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var _=2,k=0,P=null,S=1,x=1,T=60,W={name:"App",components:{progressBar:d["a"]},data:function(){return{deviceWidth:29700,deviceHeight:21e3,C5W_WIDTH:5535,C5W_HEIGHT:10100,speed:10,offset:0,currStuInfo:null,currDeviceType:-1,currPageIndex:0,step:0,percent:0,toStep:0,userImg:"",originImg:"",trails:[],blocks:[],isPlay:!1}},computed:{canvasHeight:function(){return window.innerHeight},canvasWidth:function(){return this.canvasHeight/(this.deviceWidth/this.deviceHeight)},gap:function(){return Math.ceil(100/this.trails.length)}},filters:{formatDate:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){var e=new Date(t);return formatDate(e,"yyyy-MM-dd hh:mm")})},mounted:function(){var t=localStorage.getItem("playSpeed");if(t&&(this.speed=t),console.log(this.canvasWidth,this.canvasHeight),this.currPageIndex=parseInt(p["a"].getUrlPrams("index")),this.currStuInfo=JSON.parse(localStorage.getItem("currStuInfo")),this.currStuInfo){var e=!0,i=!1,s=void 0;try{for(var a,n=this.currStuInfo[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){a.value;var r=new Image;r.src=this.imgUrl;var o=new Image;o.src=this.recogImgUrl}}catch(c){i=!0,s=c}finally{try{e||null==n.return||n.return()}finally{if(i)throw s}}}this.initCanvas(),this.initData()},methods:(s={initData:function(){this.userImg=this.currStuInfo[this.currPageIndex].recogImgUrl,this.originImg=this.currStuInfo[this.currPageIndex].imgUrl,this.locadBlocks(),this.locadNoteInfo()},initCanvas:function(){var t=document.getElementById("myCanvas");P=t.getContext("2d"),P.translate(.5,.5),P.fillStyle="rgba(255, 255, 255, 0)"},closeWindow:function(){window.cefQuery({request:"closeWindowPlayer",onsuccess:function(t){console.log("invoke success response = "+t)},onFailure:function(t,e){console.log("invoke fail code = "+t+" msg:"+e)}})},setPercent:function(t){console.log(t),k=0,this.isPlay=!1,P.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.toStep=parseInt(t*this.trails.length/100),this.step=0,this.speed=0,this.playTrails()},checkPre:function(){this.currPageIndex-=1,this.initData()},checkNext:function(){this.currPageIndex+=1,this.initData()},setSpeed:function(t){this.speed=t,localStorage.setItem("playSpeed",t)},play:function(){0==this.speed&&(this.speed=10);var t=this.currStuInfo[this.currPageIndex].blockKey;t?(this.isPlay=!this.isPlay,this.isPlay&&this.playTrails()):console.log("该页没有笔迹")},playTrails:function(){var t=this.step,e=this.toStep;t<e?this.readTrails(this.trails[t].color,this.trails[t].data,0):t<this.trails.length&&this.isPlay?this.readTrails(this.trails[t].color,this.trails[t].data,0):t==this.trails.length&&(this.step=0,this.percent=0,this.toStep=0,this.isPlay=!1,P.clearRect(0,0,this.canvasWidth,this.canvasHeight))}},I(s,"closeWindow",function(){window.cefQuery({request:"closeWindowPlayer",onSuccess:function(t){console.log("invoke success response = "+t)},onFailure:function(t,e){console.log("invoke fail code = "+t+" msg:"+e)}})}),I(s,"locadNoteInfo",function(){var t=this,e=this.currStuInfo[this.currPageIndex].noteKey,i=y.a.api_trails_secret,s=y.a.api_trails_source;console.log(s);var a=y.a.api_trails+"notes/item_for_system",n={source:s,note_key:e,e:Date.parse(new Date)/1e3},r=f["a"].getToken(a,i,n);b.a.post(y.a.api_trails+"notes/item_for_system",{source:s,note_key:e,e:Date.parse(new Date)/1e3,token:r}).then(function(e){t.currDeviceType=e.data.data.device}).catch(function(t){console.log(t)})}),I(s,"locadBlocks",function(){var t=this,e=this.currStuInfo[this.currPageIndex].noteKey,i=this.currStuInfo[this.currPageIndex].blockKey,s=y.a.api_trails_secret,a=y.a.api_trails_source,n=y.a.api_trails+"trails/block",r={source:a,note_key:e,block_key:i,limit:500,offset:t.offset,e:Date.parse(new Date)/1e3},o=f["a"].getToken(n,s,r);b.a.post(y.a.api_trails+"trails/block",{source:a,note_key:e,block_key:i,limit:500,offset:t.offset,e:Date.parse(new Date)/1e3,token:o}).then(function(e){var i=e.data.data;if(t.offset+=i.length,null!=i&&i.length>0){var s=[];null==i&&(i=[]),i.forEach(function(t){t.data&&(t.data=new DataView(v.a.decode(t.data.replace(/-/g,"+").replace(/_/g,"/"))),s.push(t))}),t.trails=s,500===i.length&&t.locadBlocks()}t.blocks=t.blocks.concat(i)}).catch(function(t){console.log(t)})}),I(s,"drawTrails",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-65536,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,u=S*e,h=x*i,d=s,p=(t+4294967296).toString(16).substr(-6);if(0===t?(P.globalCompositeOperation="destination-out",d=10*s):P.globalCompositeOperation="source-over",P.setLineCap="round",16==l||0==l)return this.isStart>0&&(this.isStart>1?P.lineTo(a,n):P.lineTo(a+1,n+1),P.setLineWidth(r),P.stroke()),void(k=0);if(k>0){o=S*e,c=x*i;var f=Math.sqrt(Math.pow(a-o,2)+Math.pow(n-c,2));f>_&&(u=Math.round((a+o)/2*100)/100,h=Math.round((n+c)/2*100)/100,1==k?P.lineTo(u,h):(P.quadraticCurveTo(a,n,u,h),P.lineWidth=d,P.stroke(),P.beginPath(),P.moveTo(u,h)),a=o,n=c),k++}else P.beginPath(),P.lineCap="round",P.strokeStyle="#"+p,a=u,n=h,P.moveTo(u,h),k++}),I(s,"readTrails",function(t,e){var i,s,a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this,o=this.currDeviceType;(this.isDrawTrails=!0,e.byteLength>n)?(o===T?(i=e.getFloat32(n,!0)*this.canvasWidth/10500,s=e.getFloat32(n+4,!0)*(this.canvasHeight/2.25)/6350,a=e.getFloat32(n+8,!0)*this.canvasWidth/10500):(i=e.getFloat32(n,!0)*this.canvasWidth/21e3,s=e.getFloat32(n+4,!0)*this.canvasHeight/29700,a=e.getFloat32(n+8,!0)*this.canvasWidth/21e3),this.drawTrails(t,i,s,a,17),this.speed?setTimeout(function(){n+=20,r.readTrails(t,e,n)},this.speed):(n+=20,r.readTrails(t,e,n))):(this.drawTrails(t,0,0,0,0),this.isDrawTrails=!1,this.step++,this.speed?setTimeout(function(){r.playTrails()},this.speed):r.playTrails());this.percent=100*this.step/this.trails.length}),s)},C=W,D=(i("a148"),i("34fa"),i("2877")),H=Object(D["a"])(C,u,h,!1,null,"04c3fdf8",null),O=H.exports;i("a939");l["default"].config.productionTip=!1,new l["default"]({render:function(t){return t(O)}}).$mount("#app")},a148:function(t,e,i){"use strict";var s=i("3070"),a=i.n(s);a.a}});
//# sourceMappingURL=player.js.map